<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Moodtracker</title>
  <link rel="stylesheet" href="style.css" />

  <!-- âœ… Firebase via CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>
<body>
  <h1>Moodtracker â€“ Farbkalender</h1>
  <div style="display: flex; align-items: flex-start; gap: 32px; max-width: 100vw;">
    <div style="flex: 1; min-width: 0;">
      <div>
        <span id="username"></span>
        <button id="login-btn">Login mit Google</button>
        <button id="logout-btn" style="display:none;">Logout</button>
      </div>
      <div id="tracker" style="display:none;"></div>
      <div id="calendar"></div>
    </div>
    <div id="legend-panel" style="min-width: 120px;">
      <h3>Stimmungsfarben</h3>
      <div style="display: flex; flex-direction: column; gap: 12px;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 1.5em;">ğŸ˜¢</span>
          <span style="width: 24px; height: 24px; background: #FF6B6B; border-radius: 4px; border: 1px solid #aaa; display: inline-block;"></span>
          <span>Traurig</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 1.5em;">ğŸ˜</span>
          <span style="width: 24px; height: 24px; background: #FFD93D; border-radius: 4px; border: 1px solid #aaa; display: inline-block;"></span>
          <span>Neutral</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 1.5em;">ğŸ˜Š</span>
          <span style="width: 24px; height: 24px; background: #6BCB77; border-radius: 4px; border: 1px solid #aaa; display: inline-block;"></span>
          <span>Gut</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 1.5em;">ğŸ˜</span>
          <span style="width: 24px; height: 24px; background: #4D96FF; border-radius: 4px; border: 1px solid #aaa; display: inline-block;"></span>
          <span>Sehr gut</span>
        </div>
        <div style="display: flex; align-items: center; gap: 8px;">
          <span style="font-size: 1.5em;">ğŸ¤©</span>
          <span style="width: 24px; height: 24px; background: #9D4EDD; border-radius: 4px; border: 1px solid #aaa; display: inline-block;"></span>
          <span>Super</span>
        </div>
      </div>
    </div>
  </div>
  <div id="color-picker" class="hidden">
    <button data-color="#FF6B6B" style="background-color: #FF6B6B;"></button>
    <button data-color="#FFD93D" style="background-color: #FFD93D;"></button>
    <button data-color="#6BCB77" style="background-color: #6BCB77;"></button>
    <button data-color="#4D96FF" style="background-color: #4D96FF;"></button>
    <button data-color="#9D4EDD" style="background-color: #9D4EDD;"></button>
  </div>


  <script>
    // ğŸ”§ Firebase-Konfiguration
    const firebaseConfig = {
      apiKey: "AIzaSyC0SKkvPn9GZjuu4fvayD6ThwN0MlmDArg",
      authDomain: "moodtrackerfinal.firebaseapp.com",
      projectId: "moodtrackerfinal",
      storageBucket: "moodtrackerfinal.appspot.com",
      messagingSenderId: "928967947635",
      appId: "1:928967947635:web:890bda1bf805e86d4e4106",
      measurementId: "G-JZ20PWKML3"
    };

    // ğŸ”¥ Firebase initialisieren
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    // ğŸ’» DOM-Elemente
    const loginBtn = document.getElementById("login-btn");
    const logoutBtn = document.getElementById("logout-btn");
    const tracker = document.getElementById("tracker");
    const username = document.getElementById("username");

    loginBtn.addEventListener("click", () => {
      auth.signInWithPopup(provider).catch(console.error);
    });

    logoutBtn.addEventListener("click", () => {
      auth.signOut().catch(console.error);
    });

    auth.onAuthStateChanged(user => {
      if (user) {
        username.textContent = `Angemeldet als: ${user.displayName}`;
        tracker.style.display = "block";
        logoutBtn.style.display = "inline-block";
        loginBtn.style.display = "none";
      } else {
        tracker.style.display = "none";
        logoutBtn.style.display = "none";
        loginBtn.style.display = "inline-block";
      }

      // Zugriff auf das HTML-Element, in das wir das Kalender-Raster zeichnen
const calendarEl = document.getElementById("calendar");

// Farbauswahl-Element (Popup unten am Bildschirm)
const colorPicker = document.getElementById("color-picker");

// Zwischenspeicher fÃ¼r das aktuell geklickte Datum
let selectedDate = null;

// Anzahl der Tage pro Monat (fÃ¼r 2025 â†’ Schaltjahr)
const daysPerMonth = [31, 29, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];

// FÃ¼r die Anzeige Ã¼ber jedem Monat
const monthNames = ["Jan", "Feb", "MÃ¤r", "Apr", "Mai", "Jun", "Jul", "Aug", "Sep", "Okt", "Nov", "Dez"];

/**
 * Funktion erstellt das ganze Kalender-Raster:
 *  â†’ 12 Spalten fÃ¼r Monate
 *  â†’ fÃ¼r jeden Monat entsprechende TageskÃ¤stchen
 */
function renderCalendar() {
  calendarEl.innerHTML = ""; // Kalender leeren, bevor er neu erstellt wird (ansonsten dupliziert sich der Inhalt (grid))
  for (let month = 0; month < 12; month++) {
    // Neue Spalte (div) fÃ¼r den Monat
    const column = document.createElement("div");
    column.className = "month-column";

    // Monatstitel hinzufÃ¼gen
    const label = document.createElement("div");
    label.textContent = monthNames[month];
    label.style.textAlign = "center";
    label.style.fontWeight = "bold";
    column.appendChild(label); // z.â€¯B. "JÃ¤n"

    // FÃ¼r jeden Tag im aktuellen Monat
    for (let day = 1; day <= daysPerMonth[month]; day++) {
      const cell = document.createElement("div");
      cell.className = "day-cell";

      // Format YYYY-MM-DD â€“ brauchen wir spÃ¤ter fÃ¼r Firestore oder Speicherung
      const dateString = `2025-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
      cell.dataset.date = dateString; // z.â€¯B. data-date="2025-02-01"

      // Wenn auf das KÃ¤stchen geklickt wird, wird die Farbauswahl angezeigt
      cell.addEventListener("click", () => {
        selectedDate = dateString;     // aktuell ausgewÃ¤hlter Tag merken
        showColorPicker(cell);         // Popup Ã¼ber dem Feld anzeigen
      });

      column.appendChild(cell); // Tag zur Spalte hinzufÃ¼gen
    }

    calendarEl.appendChild(column); // Monat zur KalenderÃ¼bersicht hinzufÃ¼gen
  }
}

/**
 * Zeigt die Farbauswahl direkt Ã¼ber dem geklickten Feld
 */
function showColorPicker(targetCell) {
  colorPicker.classList.remove("hidden"); // Picker anzeigen

  // Positionieren â€“ orientiert sich an der Klickposition
  const rect = targetCell.getBoundingClientRect();
  colorPicker.style.top = `${rect.top + window.scrollY - 40}px`; // etwas oberhalb
  colorPicker.style.left = `${rect.left + rect.width / 2}px`;
}

/**
 * Wenn eine Farbe im Picker geklickt wird, fÃ¤rben wir das passende KÃ¤stchen
 */
colorPicker.addEventListener("click", (e) => {
  // Hat der geklickte Button eine Datenfarbe?
  if (e.target.dataset.color && selectedDate) {
    const color = e.target.dataset.color;

    // Suche das richtige Feld mit dem gespeicherten Datum
    const targetCell = document.querySelector(`[data-date="${selectedDate}"]`);
    if (targetCell) {
      targetCell.style.backgroundColor = color; // FÃ¤rbe das Feld
    }

    // (SpÃ¤ter: Speichern in Firestore)

    // Picker ausblenden und Datum zurÃ¼cksetzen
    colorPicker.classList.add("hidden");
    selectedDate = null;
  }
});

// Starte den Kalenderaufbau direkt nach dem Laden
renderCalendar();
    });

  </script>
</body>
</html>
